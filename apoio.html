<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fam√≠lia Segolin | Formul√°rio de apoio</title>
  <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="apoio.css">
<link rel="shortcut icon" type="imagex/png" href="./assets/japao.ico">
</head>
<body>

<!-- ======== MENU ======== -->
<div class="menu-toggle" onclick="toggleMenu()">
  <i class="fa-solid fa-bars"></i>
</div>

<nav class="menu">
  <button class="close-btn" onclick="toggleMenu()">
    <i class="fa-solid fa-xmark"></i>
  </button>
  <a href="index.html">In√≠cio</a>
  <a href="sobre.html">Quem somos</a>
  <a href="galeria.html">Galeria</a>
  <a href="apoio.html" class="active">Apoie-nos 2026</a>
  <a href="oferta.html">Como ofertar</a>
</nav>


  <div class="sun"></div>
  <div class="horizon"></div>

  <h1>Formul√°rio de apoio 2026</h1>
<p>
  Este formul√°rio √© um compromisso de apoio mensal que vale de janeiro de 2026 at√© dezembro de 2026.
  Caso, no decorrer do ano, precise encerrar esse compromisso, basta nos comunicar. N√£o se preocupe nem se envergonhe. Obrigada por nos ajudar nessa caminhada.<br><br>
  "Levai as cargas uns dos outros e assim cumprireis a lei de Cristo.‚Äù - G√°latas 6:2 ARC
</p>

<form id="contact-form" action="https://formspree.io/f/mzzjapbe" method="POST" novalidate>
  
  <!-- ===== Passo 1 ===== -->
  <section id="step1">
    <label>Voc√™ vai apoiar como:*</label><br>
    <label><input type="radio" name="tipo" value="fisica" required> Pessoa f√≠sica</label><br>
    <label><input type="radio" name="tipo" value="juridica"> Pessoa jur√≠dica</label><br>
    <label><input type="radio" name="tipo" value="igreja"> Igreja</label><br>
    <label><input type="radio" name="tipo" value="grupo"> Grupo/Fam√≠lia</label><br>
    <button type="button" onclick="nextStep()">Pr√≥ximo</button>
  </section>

  <section id="step1b" style="display:none;">
    <label>Quantas pessoas h√° no grupo/fam√≠lia?</label><br>
    <input type="number" id="qtdPessoas" min="1" max="20" required><br>
    <button type="button" onclick="previousStep()">Anterior</button>
    <button type="button" onclick="gerarCampos()">Pr√≥ximo</button>
  </section>

  <section id="step1c" style="display:none;">
    <div id="camposPessoas"></div>
    <button type="button" onclick="previousStep()">Anterior</button>
    <button type="button" onclick="nextStep()">Pr√≥ximo</button>
  </section>

  <!-- ===== Passo 2 ===== -->
  <section id="step2" style="display:none;">
    <label id="labelNome">Nome e sobrenome:*<br>
      <input type="text" id="campoNome" name="nome" required>
    </label><br>

    <label id="labelAniversario">Anivers√°rio:<br>
      <input type="date" id="campoAniversario" name="aniversario">
    </label><br>

    <button type="button" onclick="previousStep()">Anterior</button>
    <button type="button" onclick="nextStep()">Pr√≥ximo</button>
  </section>

  <!-- ===== Passo 3 ===== -->
  <section id="step3" style="display:none;">
    <label>Whatsapp:<br>
      <input type="tel" name="whatsapp" required>
    </label><br>
    <label> Grupo de informativo:</label><br>
    <label><input type="radio" name="informativo" value="sim" required> Sim</label><br>
    <label><input type="radio" name="informativo" value="nao"> N√£o</label><br>
    <button type="button" onclick="previousStep()">Anterior</button>
    <button type="button" onclick="nextStep()">Pr√≥ximo</button>
  </section>

  <!-- ===== Passo 4 ===== -->
  <section id="step4" style="display:none;">
    <label>Valor:
      <input type="number" name="valor" required>
    </label>
    <select id="moeda" name="moeda">
      <option value="reais">reais</option>
      <option value="ienes">ienes</option>
      <option value="dolares">d√≥lares</option>
      <option value="outro">outro</option>
    </select><br>

    <button type="button" onclick="previousStep()">Anterior</button>
    <button type="submit">Enviar</button>
  </section>

  <!-- Mensagem de sucesso -->
  <p id="success-message" style="display:none; color:#b53039; margin-top:10px; text-shadow: 2px 2px #233a63">
    Mensagem enviada com sucesso! üéâ
  </p>

</form>

 <div class="footer-space"></div>
<footer class="footer">
  <div class="social-icons">
    <a href="https://www.instagram.com/familiasegolin/" target="_blank" class="social-icon">
      <i class="fa-brands fa-instagram"></i>
    </a>
    <a href="https://www.youtube.com/@familiasegolin" target="_blank" class="social-icon">
      <i class="fa-brands fa-youtube"></i>
    </a>
        <a href="/whatsapp.html" class="social-icon">
      <i class="fa-brands fa-whatsapp"></i>
    </a>
  </div>

  <p class="credit">Site desenvolvido com ‚ù§Ô∏è por Rebecca Segolin</p>
</footer>

<script>
  /* ======== MENU (mant√©m) ======== */
function toggleMenu() {
  const menu = document.querySelector('.menu');
  const toggle = document.querySelector('.menu-toggle');
  menu.classList.toggle('open');
  
  // Esconde o menu hamburguer quando o menu est√° aberto
  if (menu.classList.contains('open')) {
    toggle.style.display = 'none';
  } else {
    toggle.style.display = 'block';
  }
}
/* ======== SE√á√ïES E NAVEGA√á√ÉO (mant√©m sua l√≥gica) ======== */
const SECTIONS = {
  step1: document.getElementById("step1"),
  step1b: document.getElementById("step1b"),
  step1c: document.getElementById("step1c"),
  step2: document.getElementById("step2"),
  step3: document.getElementById("step3"),
  step4: document.getElementById("step4")
};
let current = "step1";
let cameFromGroup = false;

function showSection(name) {
  Object.values(SECTIONS).forEach(s => { if (s) s.style.display = "none"; });
  if (SECTIONS[name]) SECTIONS[name].style.display = "block";
  current = name;
}
showSection("step1");

function validateSection(sectionEl) {
  if (!sectionEl) return true;
  const required = Array.from(sectionEl.querySelectorAll("[required]"));
  for (const field of required) {
    if (field.type === "radio") {
      const group = sectionEl.querySelectorAll(`input[name='${field.name}']`);
      const checked = Array.from(group).some(r => r.checked);
      if (!checked) return false;
    } else {
      if (!String(field.value || '').trim()) return false;
    }
  }
  return true;
}

function nextStep() {
  const currEl = SECTIONS[current];
  if (!validateSection(currEl)) {
    alert("Por favor, preencha todos os campos obrigat√≥rios antes de continuar.");
    return;
  }

  if (current === "step1") {
    const tipo = document.querySelector('input[name="tipo"]:checked')?.value;
    if (tipo === "grupo") { cameFromGroup = true; showSection("step1b"); return; }
    else { cameFromGroup = false; atualizarCamposEtapa2(tipo); showSection("step2"); return; }
  }

  if (current === "step1b") {
    const qtd = parseInt(document.getElementById("qtdPessoas").value);
    if (!qtd || qtd < 1) { alert("Por favor, informe uma quantidade v√°lida de pessoas."); return; }
    gerarCampos(); // bot√£o tamb√©m chama isso ‚Äî fica ok
    return;
  }

  if (current === "step1c") { showSection("step3"); return; }
  if (current === "step2") { showSection("step3"); return; }
  if (current === "step3") { showSection("step4"); return; }
}

function previousStep() {
  if (current === "step1b") { showSection("step1"); cameFromGroup = false; return; }
  if (current === "step1c") { showSection("step1b"); return; }
  if (current === "step2" && cameFromGroup) { showSection("step1c"); return; }
  if (current === "step2") { showSection("step1"); return; }
  if (current === "step3") { showSection("step2"); return; }
  if (current === "step4") { showSection("step3"); return; }
}

function gerarCampos() {
  const qtd = parseInt(document.getElementById("qtdPessoas").value);
  if (!qtd || qtd < 1) { alert("Por favor, informe uma quantidade v√°lida de pessoas."); return; }
  const campos = document.getElementById("camposPessoas");
  campos.innerHTML = "";
  const limit = Math.min(qtd, 20);
  for (let i = 1; i <= limit; i++) {
    const div = document.createElement("div");
    div.style.marginTop = "8px";
    div.innerHTML = `
      <label>Nome ${i}:<br>
        <input type="text" name="nome_pessoa_${i}" required>
      </label><br>
      <label>Anivers√°rio ${i}:<br>
        <input type="date" name="aniversario_pessoa_${i}">
      </label><br>
    `;
    campos.appendChild(div);
  }
  showSection("step1c");
}

function atualizarCamposEtapa2(tipo) {
  const labelNome = document.getElementById("labelNome");
  const campoNome = document.getElementById("campoNome");
  const labelAniversario = document.getElementById("labelAniversario");
  const campoAniversario = document.getElementById("campoAniversario");
  if (!labelNome || !campoNome || !labelAniversario || !campoAniversario) return;

  if (tipo === "igreja") {
    labelNome.firstChild.nodeValue = "Nome da igreja:*\n";
    campoNome.name = "nome_igreja";
    labelAniversario.firstChild.nodeValue = "Anivers√°rio da igreja:\n";
    campoAniversario.name = "aniversario_igreja";
  } else {
    labelNome.firstChild.nodeValue = "Nome e sobrenome:*\n";
    campoNome.name = "nome";
    labelAniversario.firstChild.nodeValue = "Anivers√°rio:\n";
    campoAniversario.name = "aniversario";
  }
}

/* ====== SUBMIT: valida apenas campos VIS√çVEIS e envia com fetch ====== */
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("contact-form");
  const successMessage = document.getElementById("success-message");

  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    // 1) valida√ß√£o: pega somente inputs required das se√ß√µes *vis√≠veis* (passo atual ou step1c etc.)
    // tamb√©m inclui quaisquer inputs gerados no DOM (eles s√£o filhos de step1c)
    const visibleSections = Array.from(form.querySelectorAll("section")).filter(s => {
      // consider inline style display or computed style
      return s.offsetParent !== null; // elemento vis√≠vel na render tree
    });

    const requiredVisible = visibleSections.flatMap(s => Array.from(s.querySelectorAll("[required]")));
    for (const field of requiredVisible) {
      if (field.type === "radio") {
        const group = form.querySelectorAll(`input[name='${field.name}']`);
        const checked = Array.from(group).some(r => r.checked);
        if (!checked) { alert("Por favor, preencha todos os campos obrigat√≥rios."); return; }
      } else {
        if (!String(field.value || "").trim()) { alert("Por favor, preencha todos os campos obrigat√≥rios."); field.focus(); return; }
      }
    }

    // 2) monta FormData com TODOS os campos do form (ok) ‚Äî Formspree espera os campos do form
    const formData = new FormData(form);

    // debug (remova depois se quiser)
    console.log("Enviando FormData:", Array.from(formData.entries()));

    // 3) envia com fetch e trata resposta
    try {
      const response = await fetch(form.action, {
        method: form.method || "POST",
        body: formData,
        headers: { "Accept": "application/json" }
      });

      console.log("Resposta do servidor:", response.status, response.statusText);
      // Tenta ler o corpo pra debugar (√∫til quando Formspree retorna erros)
      let bodyText = "";
      try { bodyText = await response.text(); console.log("Corpo da resposta:", bodyText); } catch(e){}

      if (response.ok || response.status === 302) {
        // sucesso
        // esconde todas sections e mostra mensagem
        Object.values(SECTIONS).forEach(s => s && (s.style.display = "none"));
        if (successMessage) { successMessage.style.display = "block"; successMessage.scrollIntoView({behavior:"smooth"}); }
        form.reset();
        // volta para passo 1 visualmente (opcional): showSection("step1");
      } else {
        // status diferente de OK ‚Äî mostra info para o dev e alerta pro usu√°rio
        console.error("Envio n√£o OK:", response.status, bodyText);
        alert("Erro ao enviar o formul√°rio. Veja o console para detalhes ou tente novamente.");
      }
    } catch (err) {
      console.error("Erro no fetch:", err);
      alert("Erro de conex√£o. Verifique sua internet e tente novamente.");
    }
  });
});

/* exp√µe fun√ß√µes para uso inline nos bot√µes */
window.nextStep = nextStep;
window.previousStep = previousStep;
window.gerarCampos = gerarCampos;
window.atualizarCamposEtapa2 = atualizarCamposEtapa2;
</script>

</body>
</html>
